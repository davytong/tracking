<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>ğŸ’¸Salary Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />

<style>
@font-face { font-family:"KhmerOS"; src:local("Khmer OS Siemreap"); }
body { font-family:"Poppins","KhmerOS",sans-serif; background:#f4f7fb; padding:20px; }
h1 { text-align:center; color:#0d6efd; font-weight:600; margin-bottom:20px; }
.card { border-radius:16px; transition:0.3s; }
.card:hover { transform:translateY(-3px); box-shadow:0 8px 16px rgba(0,0,0,0.15); }
.fixed { background:#eef2ff; padding:8px; border-radius:8px; margin-bottom:5px; font-weight:500; }
.expense { display:flex; justify-content:space-between; background:#f8f9fa; padding:6px 10px; border-radius:8px; margin-bottom:4px; align-items:center; font-size:14px; }
.over-card { border:2px solid #dc3545; background:#ffe6e6; }
.over { color:#dc3545; font-weight:600; }
.progress { height:14px; border-radius:20px; margin-top:5px; }
.lang-btn { position:fixed; top:15px; right:15px; z-index:10; }
.btn-small { padding:0.2rem 0.5rem; font-size:0.8rem; }
</style>
</head>

<body>
<button class="btn btn-outline-primary lang-btn" id="langBtn">ááŸ’á˜áŸ‚áš</button>
<h1 id="title"></h1>

<div class="container">
  <div class="d-flex justify-content-between mb-3 flex-wrap">
    <select id="monthSelect" class="form-select w-50 mb-2"></select>
    <button class="btn btn-danger ms-2 mb-2" id="resetMonth">Reset â†º</button>
  </div>

  <div class="row" id="tracker"></div>

  <div class="card mt-4 shadow-sm">
    <div class="card-body text-center fw-bold">
      <span id="spentLabel"></span>: $<span id="grandSpent">0</span> |
      <span id="remainLabel"></span>: $<span id="grandRemain">0</span>
    </div>
  </div>
</div>

<!-- MODAL -->
<div class="modal fade" id="expModal">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 id="modalTitle"></h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <input id="expName" class="form-control mb-2" />
        <input id="expCost" type="number" class="form-control" />
      </div>
      <div class="modal-footer">
        <button class="btn btn-danger" id="deleteBtn">ğŸ§¹</button>
        <button class="btn btn-success" id="saveBtn">ğŸ’²</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
const SALARY = 320;
const HALF_DAYS = 15;

const i18n = {
en:{ title:"Salary Tracker", first:"First Half (1â€“15)", second:"Second Half (16â€“End)", spent:"Spent", remain:"Remaining", over:"OVER", add:"Add", edit:"Edit Expense", delete:"Delete", saveBtn:"Save", deleteBtn:"Delete", needRemain:"Need remain", needSpend:"Need spend", day:"days", items:{Food:"Food",Gas:"Gas",House:"House",Saving:"Saving",Oil:"Oil",Other:"Other"}, modalName:"Item name", modalCost:"Cost", resetMonth:"Reset â†º"},
km:{ title:"áá¶ášá¶á„á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„á”áŸ’ášá¶á€áŸ‹ááŸ‚", first:"á–á¶á€áŸ‹á€ááŸ’áá¶á›ááŸ‚á‘á¸áŸ¡ (áŸ¡â€“áŸ¡áŸ¥)", second:"á–á¶á€áŸ‹á€ááŸ’áá¶á›ááŸ‚á‘á¸áŸ¢ (áŸ¡áŸ¦â€“á…á»á„ááŸ‚)", spent:"á…áŸ†áá¶á™", remain:"á“áŸ…áŸá›áŸ‹", over:"á›á¾áŸ", add:"á”á“áŸ’ááŸ‚á˜", edit:"á€áŸ‚á…áŸ†áá¶á™", delete:"á›á»á”", saveBtn:"ášá€áŸ’áŸá¶á‘á»á€", deleteBtn:"á›á»á”", needRemain:"ááŸ’ášá¼áœá“áŸ…áŸá›áŸ‹", needSpend:"ááŸ’ášá¼áœá…áŸ†áá¶á™", day:"ááŸ’á„áŸƒ", items:{Food:"á¢á¶á á¶áš",Gas:"áŸá¶áŸ†á„",House:"á•áŸ’á‘áŸ‡",Saving:"áŸá“áŸ’áŸáŸ†",Oil:"á”áŸ’ášáŸá„á˜áŸ‰á¼áá¼",Other:"á•áŸ’áŸáŸá„áŸ—"}, modalName:"áˆáŸ’á˜áŸ„áŸ‡á‘áŸ†á“á·á‰", modalCost:"á…áŸ†áá¶á™", resetMonth:"áŸáŸ†á¢á¶á â†º"}
};

let lang = localStorage.getItem("lang") || "en";

const halves = [
{ key:"first", fixed:["Saving"], vars:["Food","Gas","Other"]},
{ key:"second", fixed:["House"], vars:["Food","Oil","Other"]}
];

const budgets = { Food:60, Gas:15, House:70, Saving:60, Oil:15, Other:25 };

const monthSelect = document.getElementById("monthSelect");
const y = new Date().getFullYear();
for(let m=1;m<=12;m++) monthSelect.innerHTML+=`<option>${y}-${m}</option>`;
monthSelect.value=`${y}-${new Date().getMonth()+1}`;

const key = (h,c)=>`${monthSelect.value}-${h}-${c}`;
const load = k=>JSON.parse(localStorage.getItem(k)||"[]");
const save = (k,v)=>localStorage.setItem(k,JSON.stringify(v));

let ctx=null;

function render(){
const t=i18n[lang];
title.textContent=t.title;
spentLabel.textContent=t.spent;
remainLabel.textContent=t.remain;
langBtn.textContent=lang==="en"?"ááŸ’á˜áŸ‚áš":"EN";
resetMonth.textContent=t.resetMonth;
expName.placeholder=t.modalName;
expCost.placeholder=t.modalCost;
saveBtn.textContent=t.saveBtn+" ğŸ’²";
deleteBtn.textContent=t.deleteBtn+" ğŸ§¹";

tracker.innerHTML="";
let grandTotal=0;

halves.forEach(h=>{
let halfTotal=0;

// ---- FOOD CALC FOR SUBTOTAL ----
const foodList = load(key(h.key,"Food"));
const foodSpent = foodList.reduce((a,b)=>a+b.cost,0);
const foodRemain = budgets.Food - foodSpent;
const daysUsed = foodList.length || 0;
const daysLeft = Math.max(HALF_DAYS - daysUsed, 1);
const perDay = (foodRemain / daysLeft).toFixed(2);
// --------------------------------

let html=`<div class="col-md-6 mb-3">
<div class="card shadow-sm">
<div class="card-header bg-primary text-white">${t[h.key]}</div>
<div class="card-body">`;

h.fixed.forEach(f=>{
const paid=load(key(h.key,f)).length>0;
if(paid) halfTotal+=budgets[f];
html+=`<div class="fixed">${t.items[f]} $${budgets[f]}
<input type="checkbox" class="float-end" ${paid?"checked":""}
onchange="toggleFixed('${h.key}','${f}',this.checked)">
</div>`;
});

h.vars.forEach(v=>{
let varBudget=budgets[v];
if(v==="Other" && h.key==="second") varBudget-=10;

const list=load(key(h.key,v));
const spent=list.reduce((a,b)=>a+b.cost,0);
const remain=varBudget-spent;
const over=remain<0;
halfTotal+=spent;

html+=`
<div class="card p-2 mb-2 ${over?"over-card":""}">
<b>${t.items[v]} ($${varBudget})</b>
<button class="btn btn-sm btn-primary float-end btn-small"
onclick="add('${h.key}','${v}')">${t.add} â•</button>

${list.map((e,i)=>`
<div class="expense">
${e.name} $${e.cost}
<button class="btn btn-sm btn-light btn-small"
onclick="edit('${h.key}','${v}',${i})">âœï¸</button>
</div>`).join("")}

<div class="${over?"over":""}">
${t.spent}: $${spent} |
${over?`${t.over} $${Math.abs(remain)}`:`${t.remain}: $${remain}`}
</div>

<div class="progress">
<div class="progress-bar ${over?"bg-danger":spent/varBudget>0.7?"bg-warning":"bg-success"}"
style="width:${Math.min((spent/varBudget)*100,100)}%"></div>
</div>
</div>`;
});

html+=`
<div class="card p-2 mt-2 text-center fw-bold" style="background:#eef2ff">
${t.spent}: $${foodSpent} | ${t.remain}: $${Math.max(foodRemain,0)} | ${t.needRemain}: $${foodRemain}
<br>
ğŸ“… ${t.needSpend} ~$${perDay}/${t.day} ${daysLeft} ${t.day}
</div>
</div></div></div>`;

tracker.innerHTML+=html;
grandTotal+=halfTotal;
});

grandSpent.textContent=grandTotal;
grandRemain.textContent=SALARY-grandTotal;
}

function toggleFixed(h,c,v){save(key(h,c),v?[{paid:true}]:[]);render();}
function add(h,c){ctx={h,c,i:null};expName.value="";expCost.value="";new bootstrap.Modal(expModal).show();}
function edit(h,c,i){const l=load(key(h,c));ctx={h,c,i};expName.value=l[i].name;expCost.value=l[i].cost;new bootstrap.Modal(expModal).show();}

saveBtn.onclick=()=>{
if(!ctx) return;
const l=load(key(ctx.h,ctx.c));
const e={name:expName.value,cost:+expCost.value};
ctx.i===null?l.push(e):(l[ctx.i]=e);
save(key(ctx.h,ctx.c),l);
bootstrap.Modal.getInstance(expModal).hide();
ctx=null;render();
};

deleteBtn.onclick=()=>{
if(!ctx||ctx.i===null) return;
const l=load(key(ctx.h,ctx.c));
l.splice(ctx.i,1);
save(key(ctx.h,ctx.c),l);
bootstrap.Modal.getInstance(expModal).hide();
ctx=null;render();
};

langBtn.onclick=()=>{lang=lang==="en"?"km":"en";localStorage.setItem("lang",lang);render();}
monthSelect.onchange=render;
resetMonth.onclick=()=>{halves.forEach(h=>[...h.fixed,...h.vars].forEach(c=>localStorage.removeItem(key(h.key,c))));render();}

render();
</script>





</body>
</html>