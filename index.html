<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>ğŸ’¸ Salary Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />

<style>
@font-face { font-family:"KhmerOS"; src:local("Khmer OS Siemreap"); }
body { font-family:"KhmerOS",sans-serif; background:#f4f7fb; padding:20px; }
h1 { text-align:center; color:#0d6efd; margin-bottom:20px; }

.card { border-radius:14px; }
.fixed { background:#eef2ff; padding:8px; border-radius:8px; margin-bottom:6px; }
.expense { display:flex; justify-content:space-between; background:#f8f9fa; padding:6px 10px; border-radius:8px; margin-bottom:4px; font-size:14px; }
.over { color:#dc3545; font-weight:bold; }
.lang-btn { position:fixed; top:15px; right:15px; }
.food-box { background:#e8f3ff; padding:10px; border-radius:10px; margin-top:8px; }
.warn { color:#dc3545; font-weight:bold; }
</style>
</head>

<body>
<button class="btn btn-outline-primary lang-btn" id="langBtn">ááŸ’á˜áŸ‚áš</button>
<h1 id="title"></h1>

<div class="container">
<select id="monthSelect" class="form-select mb-3 w-50"></select>

<div class="row" id="tracker"></div>

<div class="card mt-4">
<div class="card-body text-center fw-bold">
<span id="spentLabel"></span>: $<span id="grandSpent">0</span> |
<span id="remainLabel"></span>: $<span id="grandRemain">0</span>
</div>
</div>
</div>

<!-- MODAL -->
<div class="modal fade" id="expModal">
<div class="modal-dialog modal-dialog-centered">
<div class="modal-content">
<div class="modal-header">
<h5 id="modalTitle"></h5>
<button class="btn-close" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body">
<input id="expName" class="form-control mb-2" />
<input id="expCost" type="number" class="form-control" />
</div>
<div class="modal-footer">
<button class="btn btn-danger" id="deleteBtn"></button>
<button class="btn btn-success" id="saveBtn"></button>
</div>
</div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
const SALARY = 320;
const HALF = 160;
const FOOD_PLAN_DAY = 6;
const HALF_DAYS = 15;

const i18n = {
km:{
title:"áá¶ášá¶á„á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„á”áŸ’ášá¶á€áŸ‹ááŸ‚",
first:"á–á¶á€áŸ‹á€ááŸ’áá¶á›ááŸ‚á‘á¸áŸ¡",
second:"á–á¶á€áŸ‹á€ááŸ’áá¶á›ááŸ‚á‘á¸áŸ¢",
spent:"á…áŸ†áá¶á™",
remain:"á“áŸ…áŸá›áŸ‹",
add:"á”á“áŸ’ááŸ‚á˜",
edit:"á€áŸ‚á…áŸ†áá¶á™",
save:"ášá€áŸ’áŸá¶á‘á»á€",
del:"á›á»á”",
food:"á¢á¶á á¶áš",
gas:"áŸá¶áŸ†á„",
oil:"á”áŸ’ášáŸá„",
other:"á•áŸ’áŸáŸá„áŸ—",
need:"ááŸ’ášá¼áœá“áŸ…áŸá›áŸ‹",
perday:"ááŸ’ášá¼áœá…áŸ†áá¶á™",
plan:"á•áŸ‚á“á€á¶áš 60/á–á¶á€áŸ‹á€ááŸ’áá¶á› â†’ $6/ááŸ’á„áŸƒ"
},
en:{
title:"Salary Tracker",
first:"First Half",
second:"Second Half",
spent:"Spent",
remain:"Remaining",
add:"Add",
edit:"Edit",
save:"Save",
del:"Delete",
food:"Food",
gas:"Gas",
oil:"Oil",
other:"Other",
need:"Need Remaining",
perday:"Need per day",
plan:"Plan 60/half â†’ $6/day"
}
};

let lang = localStorage.getItem("lang") || "km";

const halves = [
{key:"first", items:["food","gas","other"]},
{key:"second", items:["food","oil","other"]}
];

const budgets = { food:60, gas:15, oil:15, other:25 };

const monthSelect = document.getElementById("monthSelect");
const year = new Date().getFullYear();
for(let i=1;i<=12;i++) monthSelect.innerHTML+=`<option>${year}-${i}</option>`;
monthSelect.value=`${year}-${new Date().getMonth()+1}`;

const key = (h,c)=>`${monthSelect.value}-${h}-${c}`;
const load = k=>JSON.parse(localStorage.getItem(k)||"[]");
const save = (k,v)=>localStorage.setItem(k,JSON.stringify(v));

let ctx=null;

function render(){
const t=i18n[lang];
title.textContent=t.title;
langBtn.textContent=lang==="km"?"EN":"ááŸ’á˜áŸ‚áš";
tracker.innerHTML="";
let grand=0;

halves.forEach(h=>{
let halfTotal=0;
let html=`<div class="col-md-6 mb-3"><div class="card">
<div class="card-header bg-primary text-white">${t[h.key]}</div>
<div class="card-body">`;

h.items.forEach(c=>{
let budget=budgets[c];
if(c==="other" && h.key==="second") budget=15;

const list=load(key(h.key,c));
const spent=list.reduce((a,b)=>a+b.cost,0);
const remain=budget-spent;
halfTotal+=spent;

html+=`<b>${t[c]} ($${budget})</b>
<button class="btn btn-sm btn-primary float-end" onclick="add('${h.key}','${c}')">${t.add}</button>`;

list.forEach((e,i)=>{
html+=`<div class="expense">${e.name} $${e.cost}
<button onclick="edit('${h.key}','${c}',${i})">âœï¸</button></div>`;
});

html+=`<div>${t.spent}: $${spent} | ${t.remain}: $${remain}</div>`;

if(c==="food"){
const daysUsed=list.length;
const daysLeft=Math.max(HALF_DAYS-daysUsed,1);
const perDay=(remain/daysLeft).toFixed(2);

html+=`<div class="food-box">
${t.need}: $${remain}<br>
ğŸ“… ${t.perday} ~$${perDay}/ááŸ’á„áŸƒ (${daysLeft} ááŸ’á„áŸƒ)<br>
<small>${t.plan}</small>
${perDay>FOOD_PLAN_DAY?`<div class="warn">âš ï¸ á…áŸ†áá¶á™á›á¾áŸá•áŸ‚á“á€á¶áš</div>`:""}
</div>`;
}

html+="<hr>";
});

html+=`<div class="fw-bold text-center">
Subtotal: $${halfTotal} | Remaining: $${HALF-halfTotal}
</div></div></div></div>`;

tracker.innerHTML+=html;
grand+=halfTotal;
});

grandSpent.textContent=grand;
grandRemain.textContent=SALARY-grand;
}

function add(h,c){
ctx={h,c,i:null};
expName.value="";
expCost.value="";
modalTitle.textContent=i18n[lang].edit;
new bootstrap.Modal(expModal).show();
}

function edit(h,c,i){
const l=load(key(h,c));
ctx={h,c,i};
expName.value=l[i].name;
expCost.value=l[i].cost;
modalTitle.textContent=i18n[lang].edit;
new bootstrap.Modal(expModal).show();
}

saveBtn.onclick=()=>{
const l=load(key(ctx.h,ctx.c));
const e={name:expName.value,cost:+expCost.value};
ctx.i===null?l.push(e):l[ctx.i]=e;
save(key(ctx.h,ctx.c),l);
bootstrap.Modal.getInstance(expModal).hide();
render();
};

deleteBtn.onclick=()=>{
if(ctx.i===null) return;
const l=load(key(ctx.h,ctx.c));
l.splice(ctx.i,1);
save(key(ctx.h,ctx.c),l);
bootstrap.Modal.getInstance(expModal).hide();
render();
};

langBtn.onclick=()=>{
lang=lang==="km"?"en":"km";
localStorage.setItem("lang",lang);
render();
};

monthSelect.onchange=render;
render();
</script>
</body>
</html>