<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Salary Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
@font-face {
  font-family: "KhmerOS";
  src: local("Khmer OS Siemreap");
}

body {
  background:#f4f7fb;
  padding:20px;
}

body.en { font-family: "Poppins", sans-serif; }
body.km { font-family: "KhmerOS", sans-serif; }

.card { border-radius:16px; }
.fixed { background:#eef2ff; padding:8px; border-radius:8px; margin-bottom:6px; }
.expense { display:flex; justify-content:space-between; background:#f8f9fa; padding:6px 10px; border-radius:8px; margin-bottom:4px; }
.over-card { border:2px solid #dc3545; background:#ffe6e6; }
.over { color:#dc3545; font-weight:600; }
.progress { height:12px; border-radius:20px; }

.lang-btn { position:fixed; top:15px; right:15px; }
</style>
</head>

<body class="en">

<button class="btn btn-outline-primary lang-btn" id="langBtn">ááŸ’á˜áŸ‚áš</button>
<h1 class="text-center text-primary mb-4" id="title"></h1>

<div class="container">
<div class="d-flex gap-2 mb-3">
<select id="monthSelect" class="form-select"></select>
<button class="btn btn-danger" id="resetMonth"><i class="fa fa-refresh"></i></button>
</div>

<div class="row" id="tracker"></div>

<div class="card mt-3">
<div class="card-body text-center fw-bold">
<span id="spentLabel"></span>: $<span id="grandSpent">0</span> |
<span id="remainLabel"></span>: $<span id="grandRemain">0</span>
</div>
</div>
</div>

<!-- MODAL -->
<div class="modal fade" id="expModal">
<div class="modal-dialog modal-dialog-centered">
<div class="modal-content">
<div class="modal-header">
<h5 id="modalTitle"></h5>
<button class="btn-close" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body">
<input id="expName" class="form-control mb-2">
<input id="expCost" type="number" class="form-control">
</div>
<div class="modal-footer">
<button class="btn btn-danger" id="deleteBtn"></button>
<button class="btn btn-primary" id="saveBtn"></button>
</div>
</div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
const SALARY = 320;

const i18n = {
en:{
 title:"Salary Tracker",
 first:"First Half (1â€“15)",
 second:"Second Half (16â€“End)",
 spent:"Spent", remain:"Remaining", over:"OVER",
 add:"Add", edit:"Edit Expense",
 modalName:"Item name", modalCost:"Cost",
 save:"Save", delete:"Delete", reset:"Reset",
 items:{Food:"Food",Gas:"Gas",Saving:"Saving",House:"House",Oil:"Oil",Other:"Other"}
},
km:{
 title:"áá¶ášá¶á„á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„á”áŸ’ášá¶á€áŸ‹ááŸ‚",
 first:"á–á¶á€áŸ‹á€ááŸ’áá¶á›ááŸ‚á‘á¸áŸ¡ (áŸ¡â€“áŸ¡áŸ¥)",
 second:"á–á¶á€áŸ‹á€ááŸ’áá¶á›ááŸ‚á‘á¸áŸ¢ (áŸ¡áŸ¦â€“á…á»á„ááŸ‚)",
 spent:"á…áŸ†áá¶á™", remain:"á“áŸ…áŸá›áŸ‹", over:"á›á¾áŸ",
 add:"á”á“áŸ’ááŸ‚á˜", edit:"á€áŸ‚á…áŸ†áá¶á™",
 modalName:"áˆáŸ’á˜áŸ„áŸ‡á‘áŸ†á“á·á‰", modalCost:"á…áŸ†áá¶á™",
 save:"ášá€áŸ’áŸá¶á‘á»á€", delete:"á›á»á”", reset:"áŸá˜áŸ’á¢á¶á",
 items:{Food:"á¢á¶á á¶áš",Gas:"áŸá¶áŸ†á„",Saving:"áŸá“áŸ’áŸáŸ†",House:"á•áŸ’á‘áŸ‡",Oil:"á”áŸ’ášáŸá„",Other:"á•áŸ’áŸáŸá„áŸ—"}
}
};

let lang = localStorage.getItem("lang") || "en";

const halves=[
 {key:"first", fixed:["Saving"], vars:["Food","Gas","Other"]},
 {key:"second", fixed:["House"], vars:["Food","Oil","Other"]}
];

const budgets={Food:60,Gas:15,Saving:60,House:70,Oil:15,Other:25};

const monthSelect=document.getElementById("monthSelect");
const year=new Date().getFullYear();
for(let m=1;m<=12;m++) monthSelect.innerHTML+=`<option>${year}-${m}</option>`;
monthSelect.value=`${year}-${new Date().getMonth()+1}`;

const key=(h,c)=>`${monthSelect.value}-${h}-${c}`;
const load=k=>JSON.parse(localStorage.getItem(k)||"[]");
const save=(k,v)=>localStorage.setItem(k,JSON.stringify(v));

let ctx=null;

function calcDaily(half, spent, budget){
 const today=new Date().getDate();
 const last=new Date(year,new Date().getMonth()+1,0).getDate();
 const end=half==="first"?15:last;
 const days=end-Math.min(today,end);
 if(days<=0) return null;
 return { perDay:(budget-spent)/days, days };
}

function render(){
document.body.className=lang;
const t=i18n[lang];
title.textContent=t.title;
langBtn.textContent=lang==="en"?"ááŸ’á˜áŸ‚áš":"EN";
spentLabel.textContent=t.spent;
remainLabel.textContent=t.remain;
resetMonth.textContent=t.reset;
expName.placeholder=t.modalName;
expCost.placeholder=t.modalCost;
saveBtn.textContent="ğŸ’¾ "+t.save;
deleteBtn.textContent="ğŸ—‘ "+t.delete;

tracker.innerHTML="";
let grand=0;

halves.forEach(h=>{
 let halfTotal=0;
 let html=`<div class="col-md-6 mb-3"><div class="card"><div class="card-header bg-primary text-white">${t[h.key]}</div><div class="card-body">`;

 h.fixed.forEach(f=>{
  const paid=load(key(h.key,f)).length>0;
  if(paid) halfTotal+=budgets[f];
  html+=`<div class="fixed">${t.items[f]} $${budgets[f]}
  <input type="checkbox" class="float-end" ${paid?"checked":""}
  onchange="toggleFixed('${h.key}','${f}',this.checked)"></div>`;
 });

 h.vars.forEach(v=>{
  let budget=budgets[v];
  if(v==="Other" && h.key==="second") budget-=10;
  const list=load(key(h.key,v));
  const spent=list.reduce((a,b)=>a+b.cost,0);
  const remain=budget-spent;
  const over=remain<0;
  halfTotal+=spent;

  const daily=(v==="Food")?calcDaily(h.key,spent,budget):null;

  html+=`<div class="card p-2 mb-2 ${over?"over-card":""}">
  <b>${t.items[v]} ($${budget})</b>
  <button class="btn btn-sm btn-primary float-end" onclick="add('${h.key}','${v}')">${t.add}</button>
  ${list.map((e,i)=>`<div class="expense">${e.name} $${e.cost}
  <button onclick="edit('${h.key}','${v}',${i})">âœï¸</button></div>`).join("")}
  <div class="${over?"over":""}">${t.spent}: $${spent} | ${t.remain}: $${remain}</div>
  ${daily?`<div style="font-size:13px;color:${remain<0?'#dc3545':'#198754'}">
  ğŸ“… ${lang==="km"?"ááŸ’ášá¼áœá…áŸ†áá¶á™":"Need"} ~$${daily.perDay.toFixed(2)}/${lang==="km"?"ááŸ’á„áŸƒ":"day"} (${daily.days} ${lang==="km"?"ááŸ’á„áŸƒ":"days"})
  </div>`:""}
  </div>`;
 });

 html+=`<div class="fixed text-center fw-bold">Subtotal: $${halfTotal} | Remaining: $${160-halfTotal}</div>`;
 html+=`</div></div></div>`;
 tracker.innerHTML+=html;
 grand+=halfTotal;
});

grandSpent.textContent=grand;
grandRemain.textContent=SALARY-grand;
}

function toggleFixed(h,c,v){ save(key(h,c),v?[{paid:true}]:[]); render(); }
function add(h,c){ ctx={h,c,i:null}; expName.value=""; expCost.value=""; deleteBtn.style.display="none"; new bootstrap.Modal(expModal).show(); }
function edit(h,c,i){ const l=load(key(h,c)); ctx={h,c,i}; expName.value=l[i].name; expCost.value=l[i].cost; deleteBtn.style.display="inline-block"; new bootstrap.Modal(expModal).show(); }

saveBtn.onclick=()=>{
 const l=load(key(ctx.h,ctx.c));
 const e={name:expName.value,cost:+expCost.value};
 ctx.i===null?l.push(e):l[ctx.i]=e;
 save(key(ctx.h,ctx.c),l);
 bootstrap.Modal.getInstance(expModal).hide();
 render();
};

deleteBtn.onclick=()=>{
 if(ctx.i===null) return;
 const l=load(key(ctx.h,ctx.c));
 l.splice(ctx.i,1);
 save(key(ctx.h,ctx.c),l);
 bootstrap.Modal.getInstance(expModal).hide();
 render();
};

langBtn.onclick=()=>{ lang=lang==="en"?"km":"en"; localStorage.setItem("lang",lang); render(); };
monthSelect.onchange=render;
resetMonth.onclick=()=>{ halves.forEach(h=>[...h.fixed,...h.vars].forEach(c=>localStorage.removeItem(key(h.key,c)))); render(); };

render();
</script>
</body>
</html>