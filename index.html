<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>ğŸ’¸ Salary Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />

<style>
@font-face { font-family:"KhmerOS"; src:local("Khmer OS Siemreap"); }

body { font-family:"Poppins","KhmerOS",sans-serif; background:#f4f7fb; padding:20px; }
h1 { text-align:center; color:#0d6efd; font-weight:600; margin-bottom:20px; }

.card { border-radius:16px; transition:0.3s; box-shadow:0 6px 15px rgba(0,0,0,0.1); }
.card:hover { transform:translateY(-3px); }

.fixed { background:#eef2ff; padding:8px; border-radius:8px; margin-bottom:5px; font-weight:500; display:flex; justify-content:space-between; align-items:center; }

.expense { display:flex; justify-content:space-between; background:#f8f9fa; padding:6px 10px; border-radius:8px; margin-bottom:4px; align-items:center; font-size:14px; }

.over-card { border:2px solid #dc3545; background:#ffe6e6; }
.over { color:#dc3545; font-weight:600; }

.progress { height:14px; border-radius:20px; margin-top:5px; }

.food-plan {
  background: linear-gradient(135deg,#ecfeff,#f0f9ff);
  border-left:4px solid #0ea5e9;
  border-radius:10px;
  padding:10px;
  margin-top:6px;
  font-size:14px;
}

.food-plan i { margin-right:5px; color:#0284c7; }

.lang-btn { position:fixed; top:15px; right:15px; z-index:10; }

.btn-small { padding:0.2rem 0.5rem; font-size:0.8rem; }

/* Modal buttons */
#saveBtn { background-color:#28a745; color:white; transition:0.3s; }
#saveBtn:hover { background-color:#218838; }
#deleteBtn { background-color:#dc3545; color:white; transition:0.3s; }
#deleteBtn:hover { background-color:#c82333; }

@media (max-width:576px) { #saveBtn, #deleteBtn { width:100%; margin-bottom:5px; } }

/* Modal input focus highlight */
#expName:focus, #expCost:focus, #expDate:focus { outline:none; border:2px solid #0d6efd; box-shadow:0 0 5px rgba(13,110,253,0.5); }
</style>
</head>
<body>
<button class="btn btn-outline-primary lang-btn" id="langBtn">ááŸ’á˜áŸ‚áš</button>
<h1 id="title"></h1>

<div class="container">
<div class="d-flex justify-content-between mb-3 flex-wrap">
<select id="monthSelect" class="form-select w-50 mb-2"></select>
<button class="btn btn-danger ms-2 mb-2" id="resetMonth">Reset â†º</button>
</div>

<div class="row" id="tracker"></div>
</div>

<!-- MODAL -->
<div class="modal fade" id="expModal">
<div class="modal-dialog modal-dialog-centered">
<div class="modal-content">
<div class="modal-header">
<h5 id="modalTitle"></h5>
<button class="btn-close" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body">
<input id="expName" class="form-control mb-2" placeholder="Item name" />
<input id="expCost" type="number" class="form-control mb-2" placeholder="Cost" />
<input id="expDate" type="date" class="form-control" placeholder="Date" />
</div>
<div class="modal-footer d-flex flex-column flex-sm-row justify-content-between">
<button class="btn" id="deleteBtn"></button>
<button class="btn" id="saveBtn"></button>
</div>
</div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
const HALF_DAYS = 15; // Food plan 1â€“15
const budgets = { Food:60, Gas:15, House:70, Saving:60, Oil:15, Other:25 };

const i18n = {
en:{ title:"Salary Tracker", spent:"Spent", remain:"Remaining", over:"OVER", add:"Add", edit:"Edit Expense", delete:"Delete", saveBtn:"Save", deleteBtn:"Delete", modalName:"Item name", modalCost:"Cost", modalDate:"Date", resetMonth:"Reset â†º", needRemain:"Need remain", needSpend:"Need spend", day:"days", items:{Food:"Food",Gas:"Gas",House:"House",Saving:"Saving",Oil:"Oil",Other:"Other"} },
km:{ title:"áá¶ášá¶á„á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„á”áŸ’ášá¶á€áŸ‹ááŸ‚", spent:"á…áŸ†áá¶á™", remain:"á“áŸ…áŸá›áŸ‹", over:"á›á¾áŸ", add:"á”á“áŸ’ááŸ‚á˜", edit:"á€áŸ‚á…áŸ†áá¶á™", delete:"á›á»á”", saveBtn:"ášá€áŸ’áŸá¶á‘á»á€", deleteBtn:"á›á»á”", modalName:"áˆáŸ’á˜áŸ„áŸ‡á‘áŸ†á“á·á‰", modalCost:"á…áŸ†áá¶á™", modalDate:"á€á¶á›á”ášá·á…áŸ’á†áŸá‘", resetMonth:"áŸáŸ†á¢á¶á â†º", needRemain:"ááŸ’ášá¼áœá“áŸ…áŸá›áŸ‹", needSpend:"ááŸ’ášá¼áœá…áŸ†áá¶á™", day:"ááŸ’á„áŸƒ", items:{Food:"á¢á¶á á¶áš",Gas:"áŸá¶áŸ†á„",House:"á•áŸ’á‘áŸ‡",Saving:"áŸá“áŸ’áŸáŸ†",Oil:"á”áŸ’ášáŸá„á˜áŸ‰á¼áá¼",Other:"á•áŸ’áŸáŸá„áŸ—"} }
};

let lang = localStorage.getItem("lang") || "en";
let ctx = null;

const monthSelect = document.getElementById("monthSelect");
const y = new Date().getFullYear();
for(let m=1;m<=12;m++) monthSelect.innerHTML+=`<option>${y}-${m}</option>`;
monthSelect.value=`${y}-${new Date().getMonth()+1}`;

const key = (category)=>`${monthSelect.value}-${category}`;
const load = k=>JSON.parse(localStorage.getItem(k)||"[]");
const save = (k,v)=>localStorage.setItem(k,JSON.stringify(v));

function calculateFoodPlan(foodList){
  const totalSpent = foodList.reduce((a,b)=>a+b.cost,0);
  const today = new Date().getDate();
  const daysUsed = foodList.map(e=>new Date(e.date).getDate());
  const maxDay = daysUsed.length>0 ? Math.max(...daysUsed) : 0;
  const remainingDays = HALF_DAYS - maxDay;
  const dailyBudget = budgets.Food / HALF_DAYS;
  const mustRemain = dailyBudget * remainingDays;
  const perDay = remainingDays>0 ? (mustRemain/remainingDays).toFixed(2) : 0;
  return {totalSpent, remaining: budgets.Food - totalSpent, mustRemain, perDay, remainingDays};
}

function render(){
const t = i18n[lang];
document.getElementById("title").textContent = t.title;
document.getElementById("langBtn").textContent = lang==="en"?"ááŸ’á˜áŸ‚áš":"EN";
document.getElementById("resetMonth").textContent = t.resetMonth;
document.getElementById("expName").placeholder = t.modalName;
document.getElementById("expCost").placeholder = t.modalCost;
document.getElementById("expDate").placeholder = t.modalDate;

const tracker = document.getElementById("tracker");
tracker.innerHTML = "";

Object.keys(budgets).forEach(cat=>{
  const list = load(key(cat));
  let totalSpent = list.reduce((a,b)=>a+b.cost,0);
  let remain = budgets[cat] - totalSpent;
  let over = remain < 0;
  let html = `<div class="col-md-6 mb-3">
  <div class="card shadow-sm">
  <div class="card-header ${cat==="Food"?"bg-primary":"bg-success"} text-white">${t.items[cat]} ($${budgets[cat]})</div>
  <div class="card-body">
  <button class="btn btn-sm btn-primary float-end mb-2 btn-small" onclick="add('${cat}')">${t.add} â•</button>
  ${list.map((e,i)=>`<div class="expense">${e.date} | ${e.name} $${e.cost} <button class="btn btn-sm btn-light btn-small" onclick="edit('${cat}',${i})">âœï¸</button></div>`).join('')}`;

  if(cat==="Food"){
    const {totalSpent:spentFood, remaining:remainFood, mustRemain, perDay, remainingDays} = calculateFoodPlan(list);
    html+=`<div class="food-plan">
    <i class="fa fa-utensils"></i>${t.spent}: $${spentFood} | ${t.remain}: $${remainFood} | ${t.needRemain}: $${mustRemain}<br>
    <i class="fa fa-calendar"></i>${t.needSpend} ~$${perDay}/${t.day} áŸá˜áŸ’ášá¶á”áŸ‹ ${remainingDays} ${t.day}
    </div>`;
  } else {
    html+=`<div class="${over?"over-card":""}" style="padding:6px; margin-top:6px;">
    ${t.spent}: $${totalSpent} | ${over?`${t.over} $${Math.abs(remain)}`:`${t.remain}: $${remain}`}</div>`;
  }

  html+=`</div></div></div>`;
  tracker.innerHTML+=html;
});
}

// Functions
function add(cat){ 
  ctx={cat,i:null}; 
  document.getElementById("expName").value=""; 
  document.getElementById("expCost").value=""; 
  document.getElementById("expDate").value=new Date().toISOString().split('T')[0]; 
  document.getElementById("modalTitle").textContent=i18n[lang].edit; 
  new bootstrap.Modal(expModal).show(); 
}
function edit(cat,i){ 
  const list = load(key(cat)); 
  ctx={cat,i}; 
  document.getElementById("expName").value=list[i].name; 
  document.getElementById("expCost").value=list[i].cost; 
  document.getElementById("expDate").value=list[i].date; 
  document.getElementById("modalTitle").textContent=i18n[lang].edit; 
  new bootstrap.Modal(expModal).show(); 
}

document.getElementById("saveBtn").onclick = ()=>{
  if(!ctx) return;
  const list = load(key(ctx.cat));
  const e = {
    name: document.getElementById("expName").value,
    cost: parseFloat(document.getElementById("expCost").value)||0,
    date: document.getElementById("expDate").value||new Date().toISOString().split('T')[0]
  };
  ctx.i===null ? list.push(e) : list[ctx.i]=e;
  save(key(ctx.cat),list);
  bootstrap.Modal.getInstance(expModal).hide();
  ctx=null;
  render();
};

document.getElementById("deleteBtn").onclick = ()=>{
  if(!ctx || ctx.i===null) return;
  const list = load(key(ctx.cat));
  list.splice(ctx.i,1);
  save(key(ctx.cat),list);
  bootstrap.Modal.getInstance(expModal).hide();
  ctx=null;
  render();
};

document.getElementById("langBtn").onclick = ()=>{ lang=lang==="en"?"km":"en"; localStorage.setItem("lang",lang); render(); }
monthSelect.onchange = render;
document.getElementById("resetMonth").onclick = ()=>{
  Object.keys(budgets).forEach(cat=>localStorage.removeItem(key(cat)));
  render();
}

render();
</script>
</body>
</html>