<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>ğŸ’¸ Salary Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
body { font-family:"Poppins","KhmerOS",sans-serif; background:#f4f7fb; padding:20px; }
h1 { text-align:center; color:#0d6efd; font-weight:600; margin-bottom:20px; }
.card { border-radius:16px; transition:0.3s; margin-bottom:15px; }
.card:hover { transform:translateY(-3px); box-shadow:0 8px 16px rgba(0,0,0,0.15); }
.fixed { background:#eef2ff; padding:8px; border-radius:8px; margin-bottom:5px; font-weight:500; }
.expense { display:flex; justify-content:space-between; background:#f8f9fa; padding:6px 10px; border-radius:8px; margin-bottom:4px; font-size:14px; align-items:center; flex-wrap:wrap; }
.over-card { border:2px solid #dc3545; background:#ffe6e6; }
.over { color:#dc3545; font-weight:600; }
.progress { height:14px; border-radius:20px; margin-top:5px; }
.lang-btn { position:fixed; top:15px; right:15px; z-index:10; }
.btn-small { padding:0.2rem 0.5rem; font-size:0.8rem; }

#saveBtn { background-color:#28a745; color:white; width:100%; margin-bottom:5px; }
#saveBtn:hover { background-color:#218838; }
#deleteBtn { background-color:#dc3545; color:white; width:100%; }
#deleteBtn:hover { background-color:#c82333; }
#expName,#expCost,#expDate,#expCurrency { margin-bottom:10px; }
</style>
</head>
<body>

<button class="btn btn-outline-primary lang-btn" id="langBtn">ááŸ’á˜áŸ‚áš</button>
<h1 id="title"></h1>

<div class="container">
  <div class="d-flex justify-content-between mb-3 flex-wrap">
    <select id="monthSelect" class="form-select w-50 mb-2"></select>
    <button class="btn btn-danger ms-2 mb-2" id="resetMonth">Reset â†º</button>
  </div>

  <div class="row" id="tracker"></div>

  <div class="card mt-4 shadow-sm">
    <div class="card-body text-center fw-bold">
      <span id="spentLabel"></span>: $<span id="grandSpent">0</span> |
      <span id="remainLabel"></span>: $<span id="grandRemain">0</span>
    </div>
  </div>
</div>

<!-- MODAL -->
<div class="modal fade" id="expModal">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 id="modalTitle"></h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <input id="expName" class="form-control" placeholder="Item name" />
        <div class="input-group mb-2">
          <input id="expCost" type="number" class="form-control" placeholder="Cost" />
          <select id="expCurrency" class="form-select">
            <option value="USD">$ USD</option>
            <option value="KHR">áŸ› KHR</option>
          </select>
        </div>
        <input id="expDate" type="date" class="form-control" />
      </div>
      <div class="modal-footer d-flex flex-column flex-sm-row justify-content-between">
        <button class="btn" id="deleteBtn"></button>
        <button class="btn" id="saveBtn"></button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
const SALARY = 320;
const DAILY_MAX = 4;
const EXCHANGE_RATE = 4000; // 1 USD = 4000 áŸ›
const i18n = {
  en:{ 
    title:"Salary Tracker", spent:"Spent", remain:"Remaining", over:"OVER", 
    add:"Add", edit:" Expense", saveBtn:"Save", deleteBtn:"Delete", 
    subtotal:"Subtotal", items:{Food:"Food",Gas:"Gas",House:"House",Saving:"Saving",Oil:"Oil",Other:"Other"}, 
    resetMonth:"Reset â†º", needRemain:"Must Remain", needSpend:"Need spend/day",
    modalName:"Item name", modalCost:"Cost", modalDate:"Date", modalCurrency:"Currency"
  },
  km:{ 
    title:"áá¶ášá¶á„á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„á”áŸ’ášá¶á€áŸ‹ááŸ‚", spent:"á…áŸ†áá¶á™", remain:"á“áŸ…áŸá›áŸ‹", over:"á›á¾áŸ", 
    add:"á”á“áŸ’ááŸ‚á˜", edit:"á€á¶ášá…áŸ†áá¶á™", saveBtn:"ášá€áŸ’áŸá¶á‘á»á€", deleteBtn:"á›á»á”", 
    subtotal:"áŸášá»á”", items:{Food:"á¢á¶á á¶áš",Gas:"áŸá¶áŸ†á„",House:"á•áŸ’á‘áŸ‡",Saving:"áŸá“áŸ’áŸáŸ†",Oil:"á”áŸ’ášáŸá„á˜áŸ‰á¼áá¼",Other:"á•áŸ’áŸáŸá„áŸ—"}, 
    resetMonth:"áŸáŸ†á¢á¶á â†º", needRemain:"ááŸ’ášá¼áœá“áŸ…áŸá›áŸ‹", needSpend:"ááŸ’ášá¼áœá…áŸ†áá¶á™/ááŸ’á„áŸƒ",
    modalName:"áˆáŸ’á˜áŸ„áŸ‡á‘áŸ†á“á·á‰", modalCost:"á‘á¹á€á”áŸ’ášá¶á€áŸ‹", modalDate:"á€á¶á›á”ášá·á…áŸ’á†áŸá‘", modalCurrency:"ášá¼á”á·á™á”áŸááŸ’á"
  }
};

let lang = localStorage.getItem("lang") || "en";

const halves = [
  { key:"first", fixed:["Saving"], vars:["Food","Gas","Other"]},
  { key:"second", fixed:["House"], vars:["Food","Oil","Other"]}
];

const budgets = { Food:60, Gas:15, House:70, Saving:60, Oil:15, Other:25 };

const monthSelect = document.getElementById("monthSelect");
const y = new Date().getFullYear();
for(let m=1;m<=12;m++) monthSelect.innerHTML+=`<option>${y}-${m}</option>`;
monthSelect.value=`${y}-${new Date().getMonth()+1}`;

const key = (h,c)=>`${monthSelect.value}-${h}-${c}`;
const load = k=>JSON.parse(localStorage.getItem(k)||"[]");
const save = (k,v)=>localStorage.setItem(k,JSON.stringify(v));
let ctx=null;

function render(){
  const t = i18n[lang];

  title.textContent = t.title;
  spentLabel.textContent = t.spent;
  remainLabel.textContent = t.remain;
  langBtn.textContent = lang==="en"?"ááŸ’á˜áŸ‚áš":"EN";
  resetMonth.textContent = t.resetMonth;

  expName.placeholder = t.modalName;
  expCost.placeholder = t.modalCost;
  expDate.placeholder = t.modalDate;
  saveBtn.textContent = t.saveBtn + " ğŸ’²";
  deleteBtn.textContent = t.deleteBtn + " ğŸ§¹";
  deleteBtn.style.display = ctx && ctx.i!==null ? "inline-block" : "none";

  tracker.innerHTML="";
  let grandTotal=0;

  halves.forEach(h=>{
    let halfTotal=0;
    let halfTitle = h.key==="first" ? (lang==="en"?"1st Half (1â€“15)":"á–á¶á€áŸ‹á€ááŸ’áá¶á›ááŸ‚á‘á¸áŸ¡ (áŸ¡â€“áŸ¡áŸ¥)") : (lang==="en"?"2nd Half (16â€“End)":"á–á¶á€áŸ‹á€ááŸ’áá¶á›ááŸ‚á‘á¸áŸ¢ (16â€“á…á»á„ááŸ‚)");
    let html=`<div class="col-md-6 mb-3"><div class="card shadow-sm">
      <div class="card-header bg-primary text-white">${halfTitle}</div>
      <div class="card-body">`;

    h.fixed.forEach(f=>{
      const paid=load(key(h.key,f)).length>0;
      if(paid) halfTotal+=budgets[f];
      html+=`<div class="fixed">${t.items[f]} $${budgets[f]}<input type="checkbox" class="float-end" ${paid?"checked":""} onchange="toggleFixed('${h.key}','${f}',this.checked)"></div>`;
    });

    h.vars.forEach(v => {
      let varBudget = budgets[v];
      const list = load(key(h.key, v));
      let spent = list.reduce((a,b)=>a+b.cost,0);
      let remain = varBudget - spent;
      halfTotal += spent;
      const over = remain < 0;

      const displayList = [...list].sort((a,b)=>new Date(a.date)-new Date(b.date));

      let itemsHTML = "";
      displayList.forEach(e=>{
        const realIndex = list.indexOf(e);
        itemsHTML += `
          <div class="expense">
            ${e.date} | ${e.name} $${e.cost.toFixed(2)}
            <button type="button" class="btn btn-sm btn-light btn-small" onclick="edit('${h.key}','${v}',${realIndex})">âœï¸</button>
          </div>`;
      });

      let foodPlan = "";
      if(v==="Food"){
        const today = new Date();
        const dayOfMonth = today.getDate();
        let endDay = (h.key==="first"?15:new Date(today.getFullYear(),today.getMonth()+1,0).getDate());
        const daysLeft = endDay - dayOfMonth + 1;
        const mustRemain = (daysLeft*DAILY_MAX).toFixed(2);
        foodPlan = `<div class="mt-2 p-2 rounded" style="background:#eef6ff;font-size:14px">
          ${t.items[v]} ($${varBudget})<br>${t.spent}: $${spent.toFixed(2)} | ${t.remain}: $${remain.toFixed(2)} | ${t.needRemain}: $${mustRemain}<br>
          ğŸ“… ${lang==="en"?daysLeft+" day left": "á“áŸ…áŸá›áŸ‹ "+daysLeft+" ááŸ’á„áŸƒ"} 
        </div>`;
      }

      html += `<div class="card p-2 mb-2 ${over?"over-card":""}">
        <b>${t.items[v]} ($${varBudget})</b>
        <button class="btn btn-sm btn-primary float-end btn-small" onclick="add('${h.key}','${v}')">${t.add} â•</button>
        ${itemsHTML}
        <div class="${over?"over":""}">${t.spent}: $${spent.toFixed(2)} | ${over?`${t.over} $${Math.abs(remain).toFixed(2)}`:`${t.remain}: $${remain.toFixed(2)}`}</div>
        ${foodPlan}
        <div class="progress"><div class="progress-bar ${over?"bg-danger":spent/varBudget>0.7?"bg-warning":"bg-success"}" style="width:${Math.min((spent/varBudget)*100,100)}%"></div></div>
      </div>`;
    });

    html+=`<div class="card p-2 mt-2 text-center fw-bold" style="background:#eef2ff">${t.subtotal}: $${halfTotal.toFixed(2)} | ${t.remain}: $${(SALARY/2-halfTotal).toFixed(2)}</div>`;
    html+=`</div></div></div>`;
    tracker.innerHTML += html;
    grandTotal += halfTotal;
  });

  grandSpent.textContent = grandTotal.toFixed(2);
  grandRemain.textContent = (SALARY-grandTotal).toFixed(2);
}

// Functions
function toggleFixed(h,c,v){ save(key(h,c),v?[{paid:true}]:[]); render(); }
function add(h,c){ ctx={h,c,i:null}; expName.value=""; expCost.value=""; expCurrency.value="USD"; expDate.value=new Date().toISOString().split('T')[0]; modalTitle.textContent=i18n[lang].edit; render(); new bootstrap.Modal(expModal).show(); }
function edit(h,c,i){ const l=load(key(h,c)); ctx={h,c,i}; expName.value=l[i].name; expCost.value=l[i].cost; expCurrency.value="USD"; expDate.value=l[i].date; modalTitle.textContent=i18n[lang].edit; render(); new bootstrap.Modal(expModal).show(); }

saveBtn.onclick=()=>{
  if(!ctx) return;
  let cost = +expCost.value;
  if(expCurrency.value==="KHR") cost = Math.round(cost/EXCHANGE_RATE*100)/100;
  const l = load(key(ctx.h,ctx.c));
  const e = {name: expName.value, cost: cost, date: expDate.value};
  ctx.i===null?l.push(e):(l[ctx.i]=e);
  save(key(ctx.h,ctx.c),l);
  bootstrap.Modal.getInstance(expModal).hide();
  ctx=null;
  render();
};

deleteBtn.onclick=()=>{
  if(!ctx||ctx.i===null) return;
  const l=load(key(ctx.h,ctx.c));
  l.splice(ctx.i,1);
  save(key(ctx.h,ctx.c),l);
  bootstrap.Modal.getInstance(expModal).hide();
  ctx=null;
  render();
};

langBtn.onclick=()=>{ lang=lang==="en"?"km":"en"; localStorage.setItem("lang",lang); render();}
monthSelect.onchange=render;
resetMonth.onclick=()=>{ halves.forEach(h=>[...h.fixed,...h.vars].forEach(c=>localStorage.removeItem(key(h.key,c)))); render(); }

render();
</script>
</body>
</html>